<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="description" content="cycle exact Amiga emulator in html5 / javascript. This Amiga emulator is compatible to the progressive-web-app (PWA) standard.">
    <title>vAmigaWeb</title>
  
  <link rel="icon" href="img/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <link rel="manifest" href="manifest.json">
  <!-- ios support -->
  <link rel="apple-touch-icon" href="img/icon-96x96.png">
  <meta name="apple-mobile-web-app-status-bar" content="#FFE1C4">
  <meta name="theme-color" content="#BBBBBB">


  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/vAmiga.css">
  <script src="js/jquery-3.6.0.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/vAmiga_browser.js"></script>
  <script src="js/ringbuffer.js"></script>
  <script src="js/vAmiga_ui.js"></script>
  <script src="js/vAmiga_storage.js"></script>
  <script src="js/vAmiga_keyboard.js"></script>
  <script src="js/vAmiga_action_script.js"></script>
  <script src="js/virtualjoystick.js"></script>
  <script src="js/jszip.min.js"></script>
    <style>
      .emscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
      textarea.emscripten { font-family: monospace; width: 80%; }
      div.emscripten { text-align: center; }
      div.emscripten_border { border: 0px solid black; }
      /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
      canvas.emscripten 
      { border: 0px none; }
      .spinner {
        height: 50px;
        width: 50px;
        margin: 0px auto;
        -webkit-animation: rotation .8s linear infinite;
        -moz-animation: rotation .8s linear infinite;
        -o-animation: rotation .8s linear infinite;
        animation: rotation 0.8s linear infinite;
        border-left: 10px solid rgb(0,150,240);
        border-right: 10px solid rgb(0,150,240);
        border-bottom: 10px solid rgb(0,150,240);
        border-top: 10px solid rgb(100,0,200);
        border-radius: 100%;
        background-color: rgb(200,100,250);
      }
      @-webkit-keyframes rotation {
        from {-webkit-transform: rotate(0deg);}
        to {-webkit-transform: rotate(360deg);}
      }
      @-moz-keyframes rotation {
        from {-moz-transform: rotate(0deg);}
        to {-moz-transform: rotate(360deg);}
      }
      @-o-keyframes rotation {
        from {-o-transform: rotate(0deg);}
        to {-o-transform: rotate(360deg);}
      }
      @keyframes rotation {
        from {transform: rotate(0deg);}
        to {transform: rotate(360deg);}
      }
    </style>
  </head>
  <body data-theme="dark">
    <figure style="overflow:visible;" id="spinner"><div class="spinner"></div><center style="margin-top:0.5em"><img src="img/vAmigaIcon.png" style="width:5em; height:5em"/><strong>booting into vAmiga WebEdition...</strong></center></figure>
    <div class="emscripten" id="status">Downloading...</div>
    <div class="emscripten">
      <progress value="0" max="100" id="progress" hidden=1></progress>  
    </div>

    <div id="div_canvas" class="emscripten_border">
      <canvas class="emscripten" width="724" height="568" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>
    </div>
    <!-- virtual keyboard-->
    <!-- 
      we pin the keyboard collapsable at the bottom and give it the full width 
    -->
    <div class="collapse" style="user-select: none;" id="virtual_keyboard">
      <div class="justify-content-center" id="vbk_scroll_area"
        style="display: flex;flex-wrap: nowrap;overflow-x: auto;">
        <div style="flex: 0 0 auto;padding-right: 15px;padding-left: 15px;position: relative;min-width: 0;max-width: 100%;">
          <!-- 
            the following absolute width defines the scrollable area
            if it is to short then some keys on the outer egdes are clipped
          -->
          <div style="width:780px;" id="divKeyboardRows"></div>      
        </div>
      </div>
    </div>



    <button id="button_show_menu"
    style="position: fixed; top:0; left:0;z-index:200;" 
    type="button" class="btn btn-sm icon mt-2"
    data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"
    >
      <svg class="bi bi-list" width="1.6em" height="1.6em" viewBox="0 -1 16 17" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M2.5 11.5A.5.5 0 0 1 3 11h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 3h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
      </svg>
    </button>
  
    <div class="container-fluid collapse" id="navbar">
    <div class="row mt-2 mb-1">
    <div class="col-8" style="padding-left:0">
        <span style="width: 40px;display: inline-block;"></span>
        <button type="button" id="button_reset" class="btn btn-sm icon" data-toggle="tooltip" data-placement="top" title="reset">
          <svg class="bi bi-skip-start-fill" width="1.6em" height="1.6em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M4.5 3.5A.5.5 0 0 0 4 4v8a.5.5 0 0 0 1 0V4a.5.5 0 0 0-.5-.5z"/>
            <path d="M4.903 8.697l6.364 3.692c.54.313 1.232-.066 1.232-.697V4.308c0-.63-.692-1.01-1.232-.696L4.903 7.304a.802.802 0 0 0 0 1.393z"/>
          </svg>
        </button>
        <span class="d-inline-block" data-toggle="tooltip" data-placement="top" title="pause">
        <button type="button" id="button_run" class="btn btn-sm icon">
          <svg class="bi bi-pause-fill" width="1.6em" height="1.6em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/>
          </svg>
        </button>
        </span>      
      <button type="button" id="button_take_snapshot" class="btn btn-sm icon" data-toggle="tooltip" data-placement="top" title="take snapshot">
        <svg class="bi bi-box-arrow-in-down" width="1.6em" height="1.6em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M4.646 8.146a.5.5 0 0 1 .708 0L8 10.793l2.646-2.647a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 0 1 0-.708z"/>
          <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9A.5.5 0 0 1 8 1z"/>
          <path fill-rule="evenodd" d="M1.5 13.5A1.5 1.5 0 0 0 3 15h10a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 13 4h-1.5a.5.5 0 0 0 0 1H13a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5v-8A.5.5 0 0 1 3 5h1.5a.5.5 0 0 0 0-1H3a1.5 1.5 0 0 0-1.5 1.5v8z"/>
        </svg>
      </button>
      <span data-toggle="modal" data-target="#snapshotModal">
        <button type="button" id="button_snapshots" class="btn btn-sm icon" data-toggle="tooltip" data-placement="top" title="snapshot / scene browser">
          <svg class="bi bi-collection-fill" width="1.6em" height="1.6em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <rect width="16" height="10" rx="1.5" transform="matrix(1 0 0 -1 0 14.5)"/>
            <path fill-rule="evenodd" d="M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1z"/>
          </svg>
        </button>
      </span>
      <span data-toggle="collapse" data-target="#virtual_keyboard" aria-expanded="false" aria-controls="virtual_keyboard">
        <button id="button_keyboard" class="btn btn-sm icon mr-0" type="button" data-toggle="tooltip" data-placement="top" title="virtual keyboard">
          <svg class="bi bi-type" width="1.6em" height="1.6em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.244 13.081l.943-2.803H6.66l.944 2.803H8.86L5.54 3.75H4.322L1 13.081h1.244zm2.7-7.923L6.34 9.314H3.51l1.4-4.156h.034zm9.146 7.027h.035v.896h1.128V8.125c0-1.51-1.114-2.345-2.646-2.345-1.736 0-2.59.916-2.666 2.174h1.108c.068-.718.595-1.19 1.517-1.19.971 0 1.518.52 1.518 1.464v.731H12.19c-1.647.007-2.522.8-2.522 2.058 0 1.319.957 2.18 2.345 2.18 1.06 0 1.716-.43 2.078-1.011zm-1.763.035c-.752 0-1.456-.397-1.456-1.244 0-.65.424-1.115 1.408-1.115h1.805v.834c0 .896-.752 1.525-1.757 1.525z"/>
          </svg>
        </button>
      </span>
      <button id="button_custom_key" class="btn btn-sm icon ml-0 pl-0" type="button" data-toggle="tooltip" data-placement="top" title="action buttons">
        <svg width="1.6em" height="1.6em" viewBox="0 0 16 16" class="bi bi-plus" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z"/>
          <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z"/>
        </svg>
      </button>
      <form id="theFileInput" style="display: inline-block;">
        <div id="drop_zone" class="px-1 u-full-width mr-1" data-toggle="tooltip" data-placement="bottom" title="drop .adf, .dms, .exe, .hdf .vAmiga or .zip files into here, or just click into the drop zone">
          file slot
        </div>
        <!-- iOS won't work with accept=".g64,.d64,.crt,.prg,.bin" on d64 files -->
        <input id="filedialog" name="theFileDialog" type="file" style="display:none" >
      </form>
      <button id="button_settings" class="btn btn-sm icon" type="button" data-toggle="modal" data-target="#modal_settings">
        <svg class="bi bi-gear-fill" width="1.6em" height="1.6em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" data-toggle="tooltip" data-placement="top" title="settings">
          <path fill-rule="evenodd" d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 0 0-5.86 2.929 2.929 0 0 0 0 5.858z"/>
        </svg>
      </button>       
    </div>
    <div class="col-4">
      <select id="port1" class="custom-select mr-0" data-toggle="tooltip" data-placement="left" title="game port 1">
        <option value="none">none</option>
        <option value="keys">cursor key (move) space (fire)</option>
        <option value="touch">touch joystick (move|fire)</option>
        <option value="mouse">mouse </option>
        <option value="mouse touchpad">mouse touchpad (btn|move|btn)</option>
        <option value="mouse touchpad2">mouse touchpad (move|btn/btn)</option>
      </select>
      <select id="port2" class="custom-select" data-toggle="tooltip" data-placement="left" title="game port 2">
        <option value="none">none</option>
        <option value="keys">cursor key (move) space (fire)</option>
        <option value="touch">touch joystick (move|fire)</option>
        <option value="mouse">mouse</option>
        <option value="mouse touchpad">mouse touchpad (btn|move|btn)</option>
        <option value="mouse touchpad2">mouse touchpad (move|btn/btn)</option>
      </select>
    </div>
    </div>      
  
    <div class="row mt-1" id="output_row">
    <div class="col-12 px-1">
      <!--textarea rows="20" id="output"></textarea-->
      <div id="output" style="height:164px;width:100%;padding:1px;overflow-y:scroll;resize:vertical;display:flex;flex-direction:column-reverse;font-size: smaller;"></div>
    </div>
    </div>
    </div> <!-- end of fluid container -->

<div id="alert_reset" class="alert alert-darkest" role="alert" style="display:none">
  <span class="ml-4">resetting machine, please wait ...</span>
</div>
<div id="alert_wait" class="alert alert-darkest" role="alert" style="display:none">
  <span>loading please wait ...</span>
  <div class="progress">
    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
  </div>
</div>


    <!-- Modal snapshot-->
    <div class="modal fade" id="snapshotModal" tabindex="-1" role="dialog"  aria-hidden="true">
      <div id="view_detail" style="display: none;" tabindex="-1" >
        <button type="button" id="detail_back">
<svg width="1.6em" height="1.6em" viewBox="0 0 16 16" class="bi bi-arrow-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
</svg>
        </button>
        <div id="detail_content"></div>
      </div>
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">           
            <div class="row" style="width: 100%">
              <div class="col-sm mt-2 btn-group btn-group-toggle" data-toggle="buttons">
                <label class="btn btn-primary active">
                  <input type="radio" name="options" id="sel_browser_snapshots" checked> snapshots
                </label>
                <label class="btn btn-secondary" style="display:none">
                  <input type="radio" name="options" id="sel_browser_csdb"> CSDb.dk
                </label>
              </div>
              <div class="col-sm mt-2 input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="search_symbol"><svg width="1.2em" height="1.2em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
                    <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                  </svg></span>
                </div>
                <input id="search" type="text" class="form-control" placeholder="search snapshots (local browser storage)" aria-label="search">
              </div>
            </div>
            <div id="div_like" class="mt-2 mr-1"></div>
            <button type="button" class="close px-1 py-0" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
          <div id="container_snapshots" class="container scrollx-group">
          </div><!-- container end-->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- end of Modal snapshot-->

    <!-- modal roms-->
    <div class="modal fade" id="modal_roms" tabindex="-1" role="dialog" aria-labelledby="snapshotModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="snapshotModalLabel"><img src="img/vAmigaIcon.png" style="height: 50px;" />&nbsp;SYSTEM ROMS</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            The emulator needs a kickstart system ROM file. Please drag the missing file into the empty chip socket. Or just touch or click the sockets.<br>
            <br>
            <div class="container mt-4">
            <div class="row my-2">
              <div class="col mx-2">
<div class="container card mb-3" style="max-width: 540px;">
  <div class="row no-gutters">
    <div class="col-md-8">
      <div class="card-body">
        <h5 class="card-title">kickstart rom</h5>
        <p class="card-text" id="kickstart_title"></p>
      <button type="button" id="button_delete_kickstart" class="btn btn-sm icon">
        <svg width="1.6em" height="1.6em" viewBox="0 0 16 16" class="bi bi-trash-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"/>
        </svg>
      </button>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mt-2">
        <img id="rom_kickstart" src="img/rom_empty.png" class="card-img" alt="...">
      </div>
    </div>
  </div>
</div>
              </div> 
              <div class="col mx-2"> 
<div class="container card mb-3" style="max-width: 540px;">
  <div class="row no-gutters">
    <div class="col-md-8">
      <div class="card-body">
        <h5 class="card-title">kickstart ext</h5>
        <p class="card-text" id="kickstart_ext_title">(optional)</p>
      <button type="button" id="button_delete_kickstart_ext" class="btn btn-sm icon">
        <svg width="1.6em" height="1.6em" viewBox="0 0 16 16" class="bi bi-trash-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"/>
        </svg>
      </button>
      </div>
    </div>
    <div  class="col-md-4">
      <div class="mt-2">
        <img id="rom_kickstart_ext" src="img/rom_empty.png" class="card-img" alt="...">
      </div>
    </div>
  </div>
</div>
            </div> 
          </div>
          <div class="row my-2">
            <div class="col mx-2">
              <select id="stored_roms" class="custom-select"></select> 

            </div>
            <div class="col mx-2">
              <select id="stored_exts" class="custom-select"></select>             
            </div>
          </div>

<br>
            Once loaded vAmigaWeb will try to store these files to your browsers local storage. Then on subsequent starts it will take the rom files from your browsers local storage instead of asking you again for them.

            </div>

          </div>
          <div class="modal-footer">
            <div class="justify-start"><button id="button_fetch_open_roms" type="button" class="btn btn-primary">install AROS <img style="width:2em" src="img/aros_half.png"/></button><a href="https://en.wikipedia.org/wiki/AROS_Research_Operating_System" target="_blank">&nbsp;learn more...</a></div>

            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- end of modal roms-->

    <!-- modal settings-->
    <div class="modal fade" id="modal_settings" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="settingsModalLabel"><img src="img/vAmigaIcon.png" style="height: 50px;" />Settings</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>most settings are permanent and will be saved to your local browser storage</p>    

            <button id="button_rom_dialog" type="button" class="btn btn-primary mt-2 mb-3">kickstart system roms ...</button>

            <div class="custom-control custom-switch mt-1">
              <input type="checkbox" class="custom-control-input" id="dark_switch" />
              <label class="custom-control-label" for="dark_switch">dark mode</label>
            </div>
            <div class="custom-control custom-switch mt-1" >
              <input type="checkbox" class="custom-control-input" id="pixel_art_switch"/>
              <label class="custom-control-label" for="pixel_art_switch"  data-toggle="tooltip" data-placement="right" title="on safari software rendering must be activated for pixel art">pixel art</label>
            </div>
            <div class="dropdown mr-1 mt-2">
              <span style="font-size: small">use shader rendering for full resolution in interlace modes</span>
              <br>
              <button id="button_renderer" class="btn btn-primary dropdown-toggle text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              video renderer
              </button>
              <div id="choose_renderer" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" href="#">software</a>
                  <a class="dropdown-item" href="#">gpu shader</a>
              </div> <span style="font-size: small">(a change will become effective on next start)</span>
            </div>
            <div class="dropdown mr-1 mt-2">
              <button id="button_display" class="btn btn-primary dropdown-toggle text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              visible display area
              </button>
              <div id="choose_display" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" href="#">viewport tracking</a>
                  <a class="dropdown-item" href="#">borderless</a>
                   <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="#">narrow</a>
                  <a class="dropdown-item" href="#">standard</a>
                  <a class="dropdown-item" href="#">wider</a>
                  <a class="dropdown-item" href="#">overscan</a>
              </div>
              <span style="font-size: smaller">(tracking or borderless to auto set Amigas current viewport size)</span>
            </div>
            <div class="custom-control custom-switch mt-2">
              <input type="checkbox" class="custom-control-input" id="ntsc_pixel_ratio_switch" />
              <label class="custom-control-label" for="ntsc_pixel_ratio_switch">NTSC machine and pixel aspect ratio</label>
            </div>

            <div class="custom-control custom-switch mt-2">
              <input type="checkbox" class="custom-control-input" id="wide_screen_switch" />
              <label class="custom-control-label" for="wide_screen_switch">cinematic wide screen</label>
            </div>

            <div class="dropdown mr-1 mt-2">
              <button id="button_color_palette" class="btn btn-primary dropdown-toggle text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                color
              </button>
              <div id="choose_color_palette" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#">color</a>
                <a class="dropdown-item" href="#">black white</a>
                <a class="dropdown-item" href="#">paper white</a>
                <a class="dropdown-item" href="#">green</a>
                <a class="dropdown-item" href="#">amber</a>
                <a class="dropdown-item" href="#">sepia</a>
              </div>
            </div>
            <div class="custom-control custom-switch mt-3">
              <input type="checkbox" class="custom-control-input" id="warp_switch" />
              <label class="custom-control-label" for="warp_switch">warp during disk load</label>
            </div>
            <div class="custom-control custom-switch mt-1">
              <input type="checkbox" class="custom-control-input" id="auto_snapshot_switch" />
              <label class="custom-control-label" for="auto_snapshot_switch" data-toggle="tooltip" data-placement="top" title="you find auto snapshots in the first row of the snapshot browser">save auto snapshots</label>
            </div>
            <div class="custom-control custom-switch mt-1">
              <input type="checkbox" class="custom-control-input" id="lock_action_button_switch" />
              <label class="custom-control-label" for="lock_action_button_switch" data-toggle="tooltip" data-placement="top" title="only when locked no gestures detection is done and therefore events like touchstart/end mousedown/up are processed correctly.">lock action buttons (prevent dragging and long press)</label>
            </div>

            <label class="mt-4">cut out sprite layers (stencil)</label>
            <div style="display:flex;flex-direction:row;flex-wrap:wrap">
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite0" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite0" class="custom-control-label text-muted" style="width:20px">0</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite1" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite1" class="custom-control-label text-muted" style="width:20px">1</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite2" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite2" class="custom-control-label text-muted" style="width:20px">2</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite3" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite3" class="custom-control-label text-muted" style="width:20px">3</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite4" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite4" class="custom-control-label text-muted" style="width:20px">4</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite5" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite5" class="custom-control-label text-muted" style="width:20px">5</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite6" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite6" class="custom-control-label text-muted" style="width:20px">6</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="sprite7" class="custom-control-input layer" type="checkbox" value="">
                <label for="sprite7" class="custom-control-label text-muted" style="width:20px">7</label>
              </div>
            </div>

            <label class="mt-1">cut out playfield layers (stencil)</label>
            <div style="display:flex;flex-direction:row">
             <div class="custom-control-lg custom-control custom-checkbox">
                <input id="playfield1" class="custom-control-input layer" type="checkbox" value="">
                <label for="playfield1" class="custom-control-label text-muted" style="width:20px">1</label>
              </div>
              <div class="custom-control-lg custom-control custom-checkbox">
                <input id="playfield2" class="custom-control-input layer" type="checkbox" value="">
                <label for="playfield2" class="custom-control-label text-muted" style="width:20px">2</label>
              </div>
            </div>
 
            <div class="mt-4">
              compatibility settings 
            </div>
            <div class="mt-2">
              <div class="custom-control custom-switch mt-1">
                <input type="checkbox" class="custom-control-input" id="OPT_CLX_SPR_SPR" />
                <label class="custom-control-label" for="OPT_CLX_SPR_SPR" data-toggle="tooltip" data-placement="top" title="">sprite to sprite collision</label>
              </div>
              <div class="custom-control custom-switch mt-1">
                <input type="checkbox" class="custom-control-input" id="OPT_CLX_SPR_PLF" />
                <label class="custom-control-label" for="OPT_CLX_SPR_PLF" data-toggle="tooltip" data-placement="top" title="">sprite to playfield collision</label>
              </div>
              <div class="custom-control custom-switch mt-1">
                <input type="checkbox" class="custom-control-input" id="OPT_CLX_PLF_PLF" />
                <label class="custom-control-label" for="OPT_CLX_PLF_PLF" data-toggle="tooltip" data-placement="top" title="">playfield to playfield collision</label>
              </div>
            </div>
            <div id="hardware_settings">
            </div>

<br><br>     
touch screen settings for virtual keyboard
<div class="mt-2" style="font-size: smaller">
  <button id="button_vbk_touch" class="btn btn-primary dropdown-toggle text-right mb-1" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
  keycap touch behaviour=exact timing
  </button>
  <div id="choose_vbk_touch" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
      <a class="dropdown-item" href="#">exact timing</a>
      <a class="dropdown-item" href="#">smartphone like</a>
      <a class="dropdown-item" href="#">mix of both</a>
  </div>
<br>
<div id="exact_timing_text" class="ml-3 vbk_choice_text">
  <span>exact timing</span> autorepeat and simultaneous keycap presses (disables default scroll gestures on keycaps, scroll gesture possible only on gaps around the keys)
</div>
<div id="smartphone_like_text" class="ml-3 vbk_choice_text" >
  <span>smartphone like</span> native scroll gestures on keycaps (press starts after finger is lifted from keycap for a duration of 100ms)
</div>
<div id="mix_of_both_text" class="ml-3 vbk_choice_text">
  <span>mix of both</span> tries to mix both worlds... i.e. exact timing and simultaneous presses but also scrolls keyboard when swiping the finger on keycaps. disadvantage: also does a keypress when only scrolling was intended 
</div>
</div>

            <div class="custom-control custom-switch mt-5">
              <input type="checkbox" class="custom-control-input" id="cb_debug_output" />
              <label class="custom-control-label" for="cb_debug_output">load logging console <span style="font-size:smaller">(after loaded click bottom right button)</span></label>
            </div>

            <hr>
            <div class="mt-2" style="font-size: small;">
            <p>
              <br>
              <a href="https://vamigaweb.github.io/doc/about.html" style="font-size:x-large">
                learn more about vAmigaWeb<svg class="ml-1" style="width:1em;height:1em"><use xlink:href="img/sprites.svg#link"/></svg>
              </a>
              <br><br>
              other members of the vAmiga family:
              <br><a href="https://dirkwhoffmann.github.io/vAmiga/" style="font-size:medium">take me to vAmiga for Mac<svg class="ml-1" style="width:1em;height:1em"><use xlink:href="img/sprites.svg#link"/></svg></a>              
              <br><a href="https://www.neoartcr.com/vamiga/" style="font-size:medium">take me to vAmiga Online<svg class="ml-1" style="width:1em;height:1em"><use xlink:href="img/sprites.svg#link"/></svg></a>
              <br><br>
              my 8-Bit brother:
              <br><a href="https://vc64web.github.io/doc/about.html" style="font-size:medium">take me to vc64web<svg class="ml-1" style="width:1em;height:1em"><use xlink:href="img/sprites.svg#link"/></svg></a>
            </p>

            <br><br>
            <button type="button" id="button_update" class="btn btn-primary"
            data-toggle="tooltip" data-placement="top" title="normally vAmigaWeb should update automatically. iOS does often not..."
            >update installation manually</button>
            <br><br><br>
          </div>


          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- end of modal settings-->

    <!-- modal take snapshot--->
    <div class="modal fade" id="modal_take_snapshot" tabindex="-1" role="dialog" aria-labelledby="take_snapshot_ModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="take_snapshot_ModalLabel">save snapshot to local browser space</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text" id="inputGroup-sizing-default">app title</span>
              </div>
              <input id="input_app_title" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"
              data-toggle="tooltip" data-placement="right" title="store in a snapshot browser row dedicated for this app title"
              >
            </div>
            
          </div>
          <div class="modal-footer" style="align-items: flex-start;">
            <div class="justify-start">
<div style="display:flex; flex-direction: column">
              <button id="button_export_disk" type="button" style="text-align:start" class="btn btn-success ml-2" data-toggle="tooltip" data-placement="top" title="export the current state of disk in df0">
                <svg style="width:1.2em;height:1.2em;margin-top:-7px"><use xlink:href="img/sprites.svg#share"/></svg> disk in df0</button>
              <button id="button_export_hdf" type="button" style="text-align:start" class="btn btn-success ml-2 mt-1" data-toggle="tooltip" data-placement="top" title="export the current state of hard drive">
                <svg style="width:1.2em;height:1.2em;margin-top:-7px"><use xlink:href="img/sprites.svg#share"/></svg> hd in dh0</button>
</div>
            </div>

            <button type="button" id="button_save_snapshot" class="btn btn-primary">save&nbsp;<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-return-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5z"/></svg></button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">cancel</button>
          </div>
        </div>
      </div>
    </div>
    <!--take snapshot modal-->


    <!-- custom key modal--->
    <div class="modal fade" id="modal_custom_key" tabindex="-1" role="dialog" aria-labelledby="custom_key_ModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="custom_key_ModalLabel">define an action button</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            This is the place where you can create app or game specific customized overlay buttons with free positioning ...    
            <div class="mt-3" style="display:flex;justify-content:space-between;width:100%">
              <div class="w-75">
                  label of the action button<br>
                  <input id="input_button_text" required pattern="^.+$" placeholder="try to use emojis ðŸ˜Š as icons" type="text" class="form-control" aria-label="action script" aria-describedby="inputGroup-sizing-default">
                  <div id="input_button_text_error" class="invalid-feedback">you are missing text here</div>
              </div>
              <div class="ml-2">
                shortcut key<br>
                <input id="input_button_shortcut" required pattern="^.{0,1}$" placeholder="(optional)" type="text" class="form-control ml-1" style="width:6em;margin-left: 0 !important;" aria-label="action script" aria-describedby="inputGroup-sizing-default">
                <div id="input_button_shortcut_error" class="invalid-feedback">please specify only one shortcut key</div>
              </div>
            </div>

            <div class="mt-3" style="display:flex;justify-content:flex-start;width:100%">
              <div class="dropdown">
                <button id="button_padding" class="btn btn-primary dropdown-toggle text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  size = default
                </button>
                <div id="choose_padding" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" href="#">default</a>
                  <a class="dropdown-item" href="#">0.4</a>
                  <a class="dropdown-item" href="#">0.6</a>
                  <a class="dropdown-item" href="#">0.9</a>
                  <a class="dropdown-item" href="#">1.1</a>
                  <a class="dropdown-item" href="#">1.3</a>
                  <a class="dropdown-item" href="#">1.8</a>
                  <a class="dropdown-item" href="#">2.5</a>
                  <a class="dropdown-item" href="#">3</a>
                  <a class="dropdown-item" href="#">4</a>
                  <a class="dropdown-item" href="#">6</a>
                </div>
              </div> 
              <div class="dropdown">
                <button id="button_opacity" class="ml-4 btn btn-primary dropdown-toggle text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  opacity = default
                </button>
                <div id="choose_opacity" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" href="#">default</a>
                  <a class="dropdown-item" href="#">0.1</a>
                  <a class="dropdown-item" href="#">0.2</a>
                  <a class="dropdown-item" href="#">0.3</a>
                  <a class="dropdown-item" href="#">0.4</a>
                  <a class="dropdown-item" href="#">0.5</a>
                  <a class="dropdown-item" href="#">0.6</a>
                  <a class="dropdown-item" href="#">0.7</a>
                  <a class="dropdown-item" href="#">0.8</a>
                  <a class="dropdown-item" href="#">0.9</a>
                  <a class="dropdown-item" href="#">1.0</a>
                </div>
              </div>
            </div>

            <br>
            app scope
            <div class="custom-control-lg custom-control custom-checkbox">
              <input id="check_app_scope" class="custom-control-input" type="checkbox" value="">
              <label id="check_app_scope_label" class="custom-control-label text-muted" for="check_app_scope">
              </label>
            </div> 
            <br>
            compose an action sequence, for example<br>
            <ul>
            <li><b><i>loop5{j2fire1=>120ms=>j2fire0=>90ms}</i></b>&nbsp;which will shoot 5 times</li>
            <li>or a literal action enclosed in single quotes e.g. <b>'load"$",8'</b></li>
            <li>or key combos e.g. CTRL+W &nbsp;<b>pressControlLeft=>W=>releaseControlLeft</b></li>
            <li>or&nbsp;<b>A=>await_action_button_released=>B</li> for A on button down and B on button up in locked mode (see settings)</li> 
            <li>for more complex tasks you can also choose to add a javascript ...</li>
            </ul>

            <div class="input-group mb-3 mt-2">
              <div class="dropdown" style="display:flex;justify-content:space-between;width:100%">
                <div style="display:flex">
                  <button id="button_script_language" class="btn btn-primary dropdown-toggle text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    actionscript
                  </button>
                  <div id="choose_script_language" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="#">actionscript</a>
                    <a class="dropdown-item" href="#">javascript</a>
                  </div>
                  
                  <div id="check_autocomplete" class="custom-control-lg custom-control custom-checkbox ml-3 mt-2">
                    <input id="check_livecomplete" class="custom-control-input" type="checkbox" value="">
                    <label id="check_livecomplete_label" class="custom-control-label text-muted" for="check_livecomplete">
                    live complete
                    </label>
                  </div> 
                </div>

                <div class="dropdown">
                  <button id="button_script_add" class="btn btn-primary dropdown-toggle" type="button" style="height:100%"
                  data-toggle="collapse" data-target="#predefined_actions" aria-controls="predefined_actions" aria-expanded="false" aria-label="predefined actions"                  
                  >add 
                  </button>
                </div>
                <div class="collapse" id="predefined_actions" style="position:absolute;z-index:2000;right:0;top:39px;">
                  <div>
                    <div class="dropdown">
                      <button class="btn btn-primary dropdown-toggle text-right" style="width:100%" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        javascript
                      </button>
                      <div id="add_javascript" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                      </div>
                    </div>
                    <div class="dropdown">
                      <button class="btn btn-primary dropdown-toggle text-right" style="width:100%" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        special key
                      </button>
                      <div id="add_special_key" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                      </div>
                    </div>
                    <div class="dropdown">
                      <button class="btn btn-primary dropdown-toggle text-right" style="width:100%" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        joyport1 action
                      </button>
                      <div id="add_joystick1_action" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                      </div>
                    </div>
                    <div class="dropdown">
                      <button class="btn btn-primary dropdown-toggle text-right" style="width:100%" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        joyport2 action
                      </button>
                      <div id="add_joystick2_action" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                      </div>
                    </div>
                    <div class="dropdown">
                      <button class="btn btn-primary dropdown-toggle text-right" style="width:100%" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        timer action
                      </button>
                      <div id="add_timer_action" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                      </div>
                    </div>
                    <div class="dropdown">
                      <button class="btn btn-primary dropdown-toggle text-right" style="width:100%" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        system action
                      </button>
                      <div id="add_system_action" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-1" style="width: 100%">
                <textarea id="input_action_script" style="width: 100%;" placeholder="" class="form-control" aria-label="action script" aria-describedby="inputGroup-sizing-default"></textarea>
                <div id="action_button_syntax_error" class="invalid-feedback"></div>
              </div>

            </div>

              
            
             ...  after created you can change the position of the action button by dragging ... when clicking the action button with a long press it 
goes into edit mode which takes you right back to here ...

          </div>
          <div class="modal-footer">
            <button type="button" id="button_delete_custom_button" class="btn btn-danger justify-start">delete</button>
            
            <button type="button" id="button_save_custom_button" class="btn btn-primary">save</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">cancel</button>
          </div>
        </div>
      </div>
    </div>
    <!--custom key modal-->


    <!-- file slot modal--->
    <div class="modal fade" id="modal_file_slot" tabindex="-1" role="dialog" aria-labelledby="file_slot_ModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="file_slot_ModalLabel"><span id="file_slot_dialog_label"></span></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="div_auto_load" class="custom-control custom-switch mt-1">
              <input type="checkbox" class="custom-control-input" id="auto_load"/>
              <label class="custom-control-label" for="auto_load">auto load</label>
            </div>
            <div id="div_auto_press_play" class="custom-control custom-switch mt-1">
              <input type="checkbox" class="custom-control-input" id="auto_press_play"/>
              <label class="custom-control-label" for="auto_press_play">auto press play on tape</label>
            </div>
            <div id="div_auto_run" class="custom-control custom-switch mt-1">
              <input type="checkbox" class="custom-control-input" id="auto_run"/>
              <label class="custom-control-label" for="auto_run">auto run</label>
            </div>
            
            <div id="div_zip_content"></div>

            <div id="no_disk_rom_msg" class="rounded my-2 px-2 py-2" style="display: none">Warning: no rom-chip in floppy drive installed. D64 and G64 files are floppy images ... loading of files with these extensions will require a floppy rom. Head over to roms setting and provide the rom first. Or try to load a file with a different extension.</div>

          </div>
          <div class="modal-footer">
            <div class="justify-start">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">cancel</button>
            <button id="button_eject_zip" type="button" class="btn btn-success ml-2">eject zip</button>
            </div>
            <button id="button_insert_file" type="button" class="btn btn-primary">insert</button>
          </div>
        </div>
      </div>
    </div>
    <!--file slot modal-->


    <script type='text/javascript'>
      let light_mode = false;
      if(window.location.href.indexOf('#dark=false') >=0)
      {
        light_mode=true;
      }
      else if(window.location.href.indexOf("#")>0)
      { 
        let param_part = decodeURIComponent(window.location.href.substring(window.location.href.indexOf("#")));
        
        let start_pos=param_part.indexOf('#{');        
        if(start_pos == 0 && param_part.endsWith('}'))
        {
          try {
            let dark_conf = JSON.parse(param_part.substring(1)).dark;
            light_mode = dark_conf !== undefined && dark_conf == false;
          } catch(e) {
            console.error(`error in JSON preconfig parameter: ${param_part}`);
            console.error(e);
            alert(`error in JSON preconfig parameter: \n${e}`); 
          }
          
        }
      }
      if(light_mode)
      {
        $("#canvas").css("background-color", "var(--lighterbg)");
        $("body").removeAttr( "data-theme").css("background-color", "var(--lighterbg) !important");
      }

      var statusElement = document.getElementById('status');
      var progressElement = document.getElementById('progress');
      var spinnerElement = document.getElementById('spinner');
 
      var Module = {
        preRun: [function () {
            ENV.SDL_EMSCRIPTEN_KEYBOARD_ELEMENT = "#canvas";
        }
      ],
        postRun: [InitWrappers],
        print: (function() {
          var outputElement = document.getElementById('output');
          if (outputElement) outputElement.value = ''; // clear browser cache
          return async function(text) {
            console.log(text);
/*            if(typeof live_debug_output == 'undefined') 
              return;
            if(!live_debug_output)
              return;
            if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
            //setTimeout((text) => 
            //{
              // These replacements are necessary if you render to raw HTML
              //text = text.replace(/&/g, "&amp;");
              //text = text.replace(/</g, "&lt;");
              //text = text.replace(/>/g, "&gt;");
              //text = text.replace('\n', '<br>', 'g');
              if (outputElement) {
                outputElement.innerHTML += text +'<br>';
                //outputElement.value += text + '\n';
                //outputElement.scrollTop = outputElement.scrollHeight; // focus on bottom
              }              
            //}, 0);
*/
          };
        })(),
        printErr: function(text) {
          if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
          console.error(text);
        },
        canvas: (function() {
          var canvas = document.getElementById('canvas');

          // As a default initial behavior, pop up an alert when webgl context is lost. To make your
          // application robust, you may want to override this behavior before shipping!
          // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
          canvas.addEventListener("webglcontextlost", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);

          return canvas;
        })(),
        setStatus: function(text) {
          if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
          if (text === Module.setStatus.last.text) return;
          var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
          var now = Date.now();
          if (m && now - Module.setStatus.last.time < 30) return; // if this is a progress update, skip it if too soon
          Module.setStatus.last.time = now;
          Module.setStatus.last.text = text;
          if (m) {
            text = m[1];
            progressElement.value = parseInt(m[2])*100;
            progressElement.max = parseInt(m[4])*100;
            progressElement.hidden = false;
            spinnerElement.hidden = false;
          } else {
            progressElement.value = null;
            progressElement.max = null;
            progressElement.hidden = true;
            if (!text) spinnerElement.hidden = true;
          }
          statusElement.innerHTML = text;
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left) {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
        }
      };
      Module.setStatus('Downloading...');
      window.onerror = function(msg, url, lineNo, columnNo, error) {
        if(msg.startsWith('Uncaught ')){
          _wasm_print_error( JSON.stringify(error));
        }
        var message = [
          'Error-Message: ' + msg,
          'URL: ' + url,
          'Line: ' + lineNo,
          'Column: ' + columnNo,
          'Error object: ' + JSON.stringify(error)
        ].join('\n');
        //alert(message + " -- go to settings open live debug console ...");
        document.getElementById('output').value += "\n"+ message + "\n";

        Module.setStatus('Exception thrown, see JavaScript console');
        spinnerElement.style.display = 'none';
        Module.setStatus = function(text) {
          if (text) Module.printErr('[post-exception status] ' + text);
        };
      };




      if('serviceWorker' in navigator){        
        navigator.serviceWorker.register('sw.js')
          .then(reg => {
            console.log('service worker registered')
          })
          .catch(err => console.log('service worker not registered', err));
      }

      var db;    
      //ready function
      $(function () {
        $('[data-toggle="popover"]').popover();
        //$('[data-toggle="tooltip"]').tooltip();
        $("body").tooltip({selector: '[data-toggle="tooltip"]'});
      });
    </script>
    {{{ SCRIPT }}}
  </body>
</html>
